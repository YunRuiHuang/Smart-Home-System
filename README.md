# 智能家居网络框架

更新于：02/04/2023

## 引言

当前的家庭网络以及硬件情况是，我有一台主路由以及一台二级路由，两者通过一台八口千兆交换机连接，同时挂载在交换机上的有一台FreeNAS服务器（12核+12G+2*4T硬盘rain2),一台笔记本做Linux服务器，一台闲置的树莓派，以及我的台式电脑。总之，我在思考着是否能做点什么，这时候，手边的Arduino给了我灵感。我完全可以搭建一个基于WiFi的智能家居网络呀，虽然不及蓝牙或者Zwave之类的省电，但是小功耗部件顶多勤换电池，大功耗部件直接走网线POE又不是不行，以及ESP32-wifi提供了廉价的硬件基板。只能说也不是不行。



## 框架结构

- 本框架由四大部分组成
  1. 外部传感器 （主要使用ESP32-wifi提供网络连接以及一些基础接口）
     1. 硬件使用 ESP32 Dev Model，使用Arduino IDE开发，代码更新至[endpoint](endpoint)
  2. 中间件连接 （搭建与树莓派的ExpressJs提供接口接收数据并存入数据库）
     1. 树莓派2b的性能太差了，无法在这上面开发（同时通过VScode和ssh操作会崩溃）
     2. 换回了Linux服务器上开发
  3. 数据库 （由FreeNAS提供稳定的数据存储环境来搭建数据库）
     1. 数据库也放回了Linux服务器上面，方便nodejs访问
  4. 用户界面 （Linux服务器可以承担这部分功能，稳定性并不做要求）
     1. 大概也会由expressjs提供服务
- 一些难点
  - 硬件方面，完全没接触过ESP32，所以如何连接WiFi以及如何处理数据都会比较陌生，所以先尝试只采集温度及湿度数据
    - 已完成采集温度，湿度，光亮度
    - 可通过wifi把数据post至中间件
  - 中间件部分，如何把web API部署至树莓派任值得查询
    - 已完成，主要是部署nodejs至树莓派
  - 同时，部署各种网络组件都会涉及到反向代理的问题，apache一类的代理方案都需要了解
    - 已放弃，expressjs提供的对应的功能
  - 数据库以及如何在FreeNAS部署数据库，也需要学习
    - 已放弃，数据库部署至Linux
  - 用户界面的web设计，了解web三大件与实际生产之间还是有较大差距
    - 待完成



- 更新于02/04/2023
  - 硬件部分
    - esp32需要对应的外壳
    - 温湿度传感器需要校正
  - 中间件
    - 添加更多的数据库接口来操作数据（如删除，按条件搜索）
    - 需要添加身份验证接口
  - 前端
    - 需要开发用户界面，确定界面需求





## 需求

### 外部传感器

- ESP32 Dev Model



### 中间件

- NodeJs
  - Express JS




### 数据库

- Linux搭建MySQL数据库



### 客户端

- web三大件
- Vue3 或其他
- Express JS



